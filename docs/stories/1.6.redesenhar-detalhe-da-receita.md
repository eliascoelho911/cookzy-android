# Story 1.6: Redesenhar Detalhe da Receita (protótipo Compose)

## Status
Ready

## Story
**Como** usuário do Cookzy,
**eu quero** um Detalhe de Receita com hierarquia clara e abas consistentes,
**para** ler ingredientes/preparo/nutrição com melhor legibilidade.

## Acceptance Criteria
1. App Bar flutuante transparente sobre o Hero, com botões circulares ≥48dp e ícones exclusivos do `IconRegistry`. Permite apenas ações em escopo do Épico 01 (Voltar/Fechar e Editar). Ao rolar, ganha fundo sólido mantendo contraste AA.
2. Hero full-bleed com imagem da receita (fallback ilustrado) e tempo de preparo opcional usando `IconRegistry.Timer`. Não há overlay/botão de vídeo nem badge externa.
3. Bloco textual abaixo do Hero replica o layout: título “Large” e subtítulo curto vindos de `strings.xml`, com tempo de preparo alinhado ao título quando fornecido.
4. Tabs pill fixas: Ingredientes | Instruções | Nutrição (label pode ser “Preparo”). Devem ser acessíveis (role=Tab, indicador animado, foco visível) e sincronizadas com o conteúdo.
5. Ingredientes: cabeçalho com contagem (“6 itens”) seguido de lista usando `IngredientRow`, destacando quantidades derivadas do `rawText` (negrito) sem ações de carrinho ou compra.
6. Instruções: lista numerada simples via `InstructionRow`, permitindo ênfases no texto mas sem chips de temperatura/tempo, tooltips ou CTA de vídeo.
7. Nutrição: placeholder semântico quando não houver dados; quando houver, lista simples de valores em texto (sem cartões ou gráficos).
8. Acessibilidade: controles ≥48dp, `contentDescription` no Hero, leitura correta dos destaques, ordem de foco lógica e suporte a `fontScale≈2.0`.
9. Estados: loading skeleton para Hero/tabs/conteúdos, estado vazio (sem ingredientes/nutrição) e erro com ação de tentar novamente. Nenhum estado deve introduzir Stepper, Resumo, Prep Bar ou CTA de vídeo.

### UI Parity vs Mock (design/recipe-detail/img.png)
- Elementos obrigatórios: App Bar flutuante com 2 botões leading + 3 trailing, hero com overlay Play e badge YouTube, bloco textual (título, descrição e timer), cartões de macros (4 itens), CTA “Iniciar Preparo”, Stepper de Porções, botão “Medidas”, tabs pill, lista de ingredientes com cabeçalho + CTA em pill e botão “Adicionar ao carrinho”, passos numerados com chips de temperatura/tempo e tooltip de ingredientes, placeholder de nutrição.
- Ajustes permitidos: copiar pode variar (ex.: “Preparo” vs “Instruções”), quantidade de cartões pode ajustar conforme dado recebido, mas o layout e hierarquia devem permanecer iguais. Responsividade para estados sem vídeo ou nutrição pode simplificar removendo os elementos específicos.
- Fora do mock permanecem avaliações, comentários, cronômetro persistente, overlays de compra externos e qualquer fluxo multi-step de carrinho.

## Dependencies
- PRD — Detalhe com abas e escopo: `docs/prd.md:72,111-130` (CTA de vídeo, macros, carrinho e quick actions).
- Arquitetura (Compose): padrões de abas, A11y, Previews e Iconografia: `docs/architecture.md:60,80-86`;
  Coding Standards (IconRegistry, Previews, strings.xml): `docs/architecture/coding-standards.md:72-83,100-101`;
  Tech Stack (Material Icons Extended): `docs/architecture/tech-stack.md:12,48-49`.
- Layout de referência (mock): `design/recipe-detail/img.png` (captura anexada pelo time de design).
- Protótipos Compose (Detalhe): `prototype/.../epic01/recipe/detail` (estados carregando/erro).
- DS — Componentes para RecipeDetail (pré‑requisito): `docs/stories/1.9.ds-componentes-recipe-detail.md`.

## Tasks / Subtasks
- [ ] App Bar + Hero — Implementar overlay com clusters leading/trailing, transição para fundo sólido e botão Play alinhado ao mock (AC: 1-3)
- [ ] Resumo nutricional — Renderizar cartões de macros (4 itens), responsividade e cores conforme DS (AC: 4)
- [ ] CTA e Ações rápidas — Botão “Iniciar Preparo”, Stepper de Porções e botão “Medidas” com validações/gatilhos (AC: 5-6)
- [ ] Tabs pill — Integrar componente DS com estados selecionado/foco e labels configuráveis (AC: 7)
- [ ] Ingredientes + Carrinho — Cabeçalho com contagem, lista `IngredientRow`, CTA superior/inferior e integração básica com carrinho (AC: 8)
- [ ] Instruções interativas — `InstructionRow` numerado, chips inline de tempo/temperatura e tooltip de referência a ingredientes (AC: 8)
- [ ] Nutrição — Reaproveitar cartões do resumo para aba + placeholder quando vazio (AC: 8)
- [ ] Estados/A11y — Skeletons, erro, foco/descrições para todos os controles (AC: 9-10)
- [ ] Testes Compose — Cobrir troca de abas, stepper, chips inline, CTA scroll para instruções e estados de carregamento/erro (AC: 5-10)

## Dev Notes
- Referência visual: layout `design/recipe-detail/img.png` (anexo compartilhado pelo time de design).
- Arquitetura/UI: `docs/architecture.md` (padrões de abas, estado/efeitos, scroll) e `docs/architecture/coding-standards.md` (IconRegistry, strings, previews).
- App Bar: usar variante `AppTopBar.Transparent` com `Modifier.statusBarsPadding()`. Clusters leading/trailing são `IconButton`s com fundo `CookzyColor.SurfaceInverse`. Em scroll > 56dp aplicar `AppTopBarDefaults.pinnedScrollBehavior()` e mudar cor.
- Hero e vídeo: `RecipeHero` da Story 1.9 deve aceitar `videoThumbnail` e `showPlayOverlay`. Badge YouTube fica fora do `Hero` para manter contraste.
- Resumo nutricional: reutilizar `NutritionSummaryCard` (a ser entregue na Story 1.9) ou construir `LazyRow/Grid` com 2 colunas no modo portrait. Valores vêm do view-model e devem suportar `null`.
- CTA e ações rápidas: `Iniciar Preparo` dispara `tabsState.scrollToTab(Instructions)` + `bringIntoView`. Stepper usa `rememberStepperState()` com limites 1..10; botão Medidas abre modal (mockar callback).
- Tabs: utilizar componente DS `Tabs` (pills). Labels em `strings.xml` (`recipe_detail_tab_ingredients`, etc.). Seleção controla `Pager`/`AnimatedContent`.
- Ingredientes/carrinho: `IngredientRow` recebe `AnnotatedString` com `SpanStyle(fontWeight = Bold)` para números. A ação “Adicionar ao carrinho” superior é um `TextButton`; rodapé usa `PrimaryButton` com `IconRegistry.Cart`. Integração mínima: callback com lista selecionada.
- Instruções: `InstructionRow` precisa aceitar `inlineContent` para chips de temperatura/tempo (Componentes 1.9). Referências a ingredientes devem emitir evento `OnIngredientReferenceClick(id)` para exibir tooltip (ex.: `RecipeDetailTooltipState`).
- Nutrição: reutilizar os mesmos cartões da área superior e complementar com `NutritionPlaceholder` quando sem dados.
- Strings e ícones: toda cópia em `strings.xml`; ícones exclusivos do `IconRegistry`. Nenhum `Icons.Default`.
- Previews: criar variações para (1) hero com vídeo + dados completos; (2) sem vídeo + sem nutrição; (3) instruções com chip/tooltip + fontScale 2.0.

### Testing
- Compose UI: cobrir (a) App Bar flutuante mudando de cor após scroll; (b) overlay do Play exibido apenas com vídeo; (c) cartões de macros reagindo a dados `null`; (d) Stepper limitando valores; (e) tabs navegando e sincronizando com pager; (f) chips inline e tooltip disparados em `InstructionRow`.
- Interações: testes instrumentados para `Iniciar Preparo` navegando para aba Instruções e `Adicionar ao carrinho` disparando callback com itens selecionados.
- A11y: checar `contentDescription` do Hero, foco visível nas tabs, ordem lógica entre ícones do App Bar, leitura dos chips e tooltip com `Semantics`.
- Strings/Ícones: snapshot/testes lint garantindo ausência de texto hardcoded e apenas `IconRegistry` consumido.
- Execução: `./gradlew test connectedAndroidTest` (UI Tests rodam em `RecipeDetailScreenTest`).

## QA Results
Gate: TBD (escopo atualizado pelo layout codex-clipboard-XDXpBX; revalidação obrigatória)
Reviewer: Quinn (Test Architect) — avaliação anterior inválida para o novo conjunto de requisitos
Updated: 2025-11-03
Summary: O gate anterior cobria apenas abas básicas. Após alinhar 100% com o layout (cards, CTA, stepper, chips, tooltip), é necessário refazer testes funcionais/A11y antes de liberar.
Top Issues:
- high — Sem suíte automatizada garantindo integridade do Stepper e dos chips inline; precisa ser coberta pela Story.
- medium — Novo fluxo de carrinho e tooltip requer casos de teste de acessibilidade dedicados.
Evidence: Layout atualizado, PRD seções 72/111-130 e Story 1.9 expandida; logs anteriores anexados em `docs/qa/gates/1.6-redesenhar-detalhe-da-receita.yml`.
Gate File: docs/qa/gates/1.6-redesenhar-detalhe-da-receita.yml

## Change Log
| Date       | Version | Description                         | Author |
|------------|---------|-------------------------------------|--------|
| 2025-11-03 | 0.2     | Escopo atualizado p/ layout completo (cards, CTA, stepper, chips) | PO     |
| 2025-10-23 | 0.1     | Rascunho inicial (redesign Detalhe) | PM     |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
