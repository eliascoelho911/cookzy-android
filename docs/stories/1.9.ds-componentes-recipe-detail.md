# Story 1.9: Design System — Componentes para RecipeDetail (Épico 01)

## Status
Ready

## Story
Como equipe de desenvolvimento do Cookzy,
eu quero componentes reutilizáveis no Design System para a tela de Detalhe da Receita,
para padronizar o redesign da Story 1.6 com acessibilidade, consistência visual e maior velocidade de implementação.

## Acceptance Criteria
1. `RecipeHero`: imagem opcional (Painter), título, subtítulo e tempo de preparo (`IconRegistry.Timer`). Sem overlay/badge/CTA de vídeo. Deve aceitar fallback ilustrado.
2. `TitleBlock`: título + subtítulo usando `CompositionLocalProvider` para estilos Large/Small. Slots `title`/`subtitle` aceitam `@Composable`.
3. `Tabs`: componente genérico em formato pill (configurável para outros estilos) com props `items`, `selectedIndex`, `onSelect`, `scrollable`, suporte a indicador animado/role Tab e API extensível para badges/ícones.
4. `IngredientRow`: recebe `rawText`, `highlighted: AnnotatedString?` e aplica heurística de detecção de quantidades (regex + unidades) para envolver trechos com `SpanStyle(fontWeight = Bold)` quando `highlighted` for nulo. Não há checkbox/carrinho.
5. `InstructionRow`: linha numerada simples (`index`, `text: AnnotatedString`) com tipografia padrão e espaçamento conforme layout. Sem chips ou tooltips.
6. `NutritionPlaceholder`: componente semântico para ausência de dados, usando ícone do `IconRegistry` (ex.: `IconRegistry.Nutrition`) e mensagem configurável.
7. `SectionCard`: container reutilizável do DS que encapsula `TitleBlock` (style configurável), slot de conteúdo e botão de rodapé opcional dentro de um `Card`, respeitando tokens de espaçamento e elevando somente quando necessário.
8. APIs estateless, recebendo `Modifier` e dados externos. Nenhum componente acessa `ViewModel` diretamente ou exige objetos específicos do app.
9. Acessibilidade: todos os alvos ≥48dp, tabs com role correta, `contentDescription` configurável para imagens, suporte a `fontScale≈2.0`.
10. Previews: light/dark + fontScale para cada componente (Hero, TitleBlock, Tabs, IngredientRow, InstructionRow, NutritionPlaceholder, SectionCard).

### UI Parity vs Mock (design/recipe-detail/img.png)
- Referência visual limitada às seções em escopo: App Bar com Voltar/Editar, hero com imagem + texto, tabs pill, lista de ingredientes e lista de instruções simples, além do placeholder de nutrição.
- Ignorar elementos fora do Épico 01 (Resumo Nutritivo, CTA “Iniciar Preparo”, Stepper, botão “Medidas”, overlay/badge de vídeo, chips/tooltips e ações de carrinho/favorito).
- Respeitar tokens de espaçamento e tipografia mesmo quando áreas fora de escopo estiverem ausentes, garantindo continuidade visual.

## Dependencies
- Layout de referência: `design/recipe-detail/img.png` (usar apenas áreas dentro do Épico 01).
- Story 1.6 (consumidora): `docs/stories/1.6.redesenhar-detalhe-da-receita.md`.
- PRD Detalhe: `docs/prd.md:72,111-130` (tabs e estados; ignorar seções sobre CTA/Stepper/Resumo).
- Arquitetura/Standards: `docs/architecture.md`, `docs/architecture/coding-standards.md`.

## Tasks / Subtasks
- [ ] DS — RecipeHero (imagem opcional, tempo, sem overlay de vídeo)
- [ ] DS — TitleBlock (styles Large/Small)
- [ ] DS — Tabs (pills acessíveis e extensíveis)
- [ ] DS — IngredientRow (destaque automático de quantidades)
- [ ] DS — InstructionRow (lista numerada simples)
- [ ] DS — NutritionPlaceholder (placeholder textual/visual)
- [ ] DS — SectionCard (TitleBlock + conteúdo + footer dentro de Card)
- [ ] DS — Previews
- [ ] Handoff — snippets de uso para integração na Story 1.6

## Dev Notes
- Referências cruzadas:
  - Story 1.6 (Detalhe): `docs/stories/1.6.redesenhar-detalhe-da-receita.md`
  - Layout: `design/recipe-detail/img.png` (usar apenas as áreas em escopo)
  - Arquitetura/Standards: `docs/architecture.md`, `docs/architecture/coding-standards.md`
- Componentes residem no módulo `ds`, pacote `ds.recipe.detail`, seguindo tokens de `CookzyTheme`. AppBar/ações específicas da tela continuam na feature (Story 1.6) usando `AppTopBar` + `IconRegistry` diretamente.
- Assinaturas sugeridas:
  - `@Composable fun RecipeHero(title: String, subtitle: String?, timeMinutes: Int?, image: Painter?, modifier: Modifier = Modifier)`
  - `enum class TitleBlockStyle { Large, Small }`
  - `@Composable fun TitleBlock(style: TitleBlockStyle, title: @Composable () -> Unit, subtitle: (@Composable () -> Unit)? = null, modifier: Modifier = Modifier)`
  - `data class TabItem(val label: String, val icon: ImageVector? = null, val badge: String? = null)`
  - `@Composable fun Tabs(items: List<TabItem>, selectedIndex: Int, onSelect: (Int) -> Unit, modifier: Modifier = Modifier, scrollable: Boolean = false)` — estilo `TabStyle.Pill` por padrão e suporte a personalizações futuras.
  - `@Composable fun IngredientRow(rawText: String, highlighted: AnnotatedString? = null, modifier: Modifier = Modifier)`
  - `@Composable fun InstructionRow(index: Int, text: AnnotatedString, modifier: Modifier = Modifier)`
  - `@Composable fun NutritionPlaceholder(text: String, modifier: Modifier = Modifier)`
  - `data class SectionFooterButton(val label: String, val onClick: () -> Unit, val enabled: Boolean = true)`
  - `@Composable fun SectionCard(
      modifier: Modifier = Modifier,
      titleStyle: TitleBlockStyle = TitleBlockStyle.Large,
      title: @Composable () -> Unit,
      subtitle: (@Composable () -> Unit)? = null,
      footerButton: SectionFooterButton? = null,
      content: @Composable ColumnScope.() -> Unit
    )`
- Destaque de quantidade: heurística simples (regex para números/frações + unidades comuns) aplicada quando `highlighted` não for fornecido.
- Strings/Ícones: DS aceita strings prontas mas origem deve ser `strings.xml`. Ícones apenas via `IconRegistry`.
- Previews: `@Preview` night/notnight + `fontScale = 2f` para cada componente. Usar `PlaceholderHighlight.fade()` para estados loading.

### Handoff — snippets de uso (Story 1.6)
```kotlin
@Composable
fun RecipeDetailHeader(
  state: RecipeDetailState,
  onBack: () -> Unit,
  onClose: () -> Unit,
  onEdit: () -> Unit
) {
  AppTopBar(
    title = "",
    onBack = onBack,
    style = AppTopBarStyle.Transparent,
    actions = {
      IconButton(onClick = onClose) {
        Icon(IconRegistry.Close, contentDescription = stringResource(R.string.cd_close))
      }
      IconButton(onClick = onEdit) {
        Icon(IconRegistry.Edit, contentDescription = stringResource(R.string.cd_edit))
      }
    }
  )
  RecipeHero(
    title = state.title,
    subtitle = state.subtitle,
    timeMinutes = state.timeMinutes,
    image = state.imagePainter
  )
  TitleBlock(
    style = TitleBlockStyle.Large,
    title = { Text(state.title) },
    subtitle = state.subtitle?.let { { Text(it) } }
  )
}

@Composable
fun RecipeDetailTabs(selected: Int, onSelect: (Int) -> Unit) {
  val items = listOf(
    TabItem(stringResource(R.string.recipe_detail_tab_ingredients)),
    TabItem(stringResource(R.string.recipe_detail_tab_instructions)),
    TabItem(stringResource(R.string.recipe_detail_tab_nutrition))
  )
  Tabs(items = items, selectedIndex = selected, onSelect = onSelect)
}

@Composable
fun IngredientSection(items: List<IngredientUiModel>) {
  SectionCard(
    title = { Text(stringResource(R.string.recipe_detail_tab_ingredients)) },
    content = {
      LazyColumn {
        items(items) { item ->
          IngredientRow(
            rawText = item.rawText,
            highlighted = item.highlighted
          )
        }
      }
    }
  )
}

@Composable
fun InstructionSection(steps: List<InstructionUiModel>) {
  SectionCard(
    title = { Text(stringResource(R.string.recipe_detail_tab_instructions)) },
    content = {
      LazyColumn {
        itemsIndexed(steps) { index, step ->
          InstructionRow(
            index = index + 1,
            text = step.annotated
          )
        }
      }
    }
  )
}

@Composable
fun NutritionSection(hasData: Boolean) {
  SectionCard(
    title = { Text(stringResource(R.string.recipe_detail_tab_nutrition)) },
    footerButton = SectionFooterButton(
      label = stringResource(R.string.recipe_detail_nutrition_action),
      onClick = { /* abrir notas */ }
    ),
    content = {
      if (!hasData) {
        NutritionPlaceholder(
          text = stringResource(R.string.recipe_detail_nutrition_empty)
        )
      } else {
        Text(stringResource(R.string.recipe_detail_nutrition_basic_info))
      }
    }
  )
}
```

## Change Log
| Date       | Version | Description                            | Author |
|------------|---------|----------------------------------------|--------|
| 2025-11-03 | 0.3     | Escopo realinhado ao Épico 01 (somente componentes básicos) | PO     |
| 2025-11-03 | 0.2     | Alinhado ao layout (AppBar, cards, CTA, stepper, chips, tooltip) | PO     |
| 2025-11-03 | 0.1     | Rascunho inicial (DS RecipeDetail)     | PO     |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
Gate: TBD (escopo realinhado; aguardar revisão focada nos componentes básicos)
Reviewer: Quinn (Test Architect)
Updated: 2025-11-03
Summary: Com a remoção de Stepper/CTA/tooltips, os componentes se restringem a App Bar, Hero, Tabs e listas. QA deve verificar apenas esses blocos e garantir cobertura de destaque automático de ingredientes.
Top Issues:
- medium — Falta teste garantindo heurística de quantidade em `IngredientRow`.
- medium — Necessário validar role/tab navegação do `Tabs` em TalkBack.
Evidence: Epic `docs/epics/01-crud-de-receitas.md`, Story 1.6 atualizada, protótipo `design/recipe-detail/img.png`.
Gate File: docs/qa/gates/1.9-ds-componentes-recipe-detail.yml (gerar após review)
