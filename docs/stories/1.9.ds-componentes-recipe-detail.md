# Story 1.9: Design System — Componentes para RecipeDetail (Épico 01)

## Status
Ready

## Story
Como equipe de desenvolvimento do Cookzy,
eu quero componentes reutilizáveis no Design System para a tela de Detalhe da Receita,
para padronizar o redesign da Story 1.6 com acessibilidade, consistência visual e maior velocidade de implementação.

## Acceptance Criteria
1. `RecipeAppBarActions`: clusters leading/trailing com botões circulares ≥48dp, ícones do `IconRegistry`, suporte a Voltar/Fechar e Editar (única ação de trailing em escopo). Sem botões de compartilhamento/favorito. Comportamento para scroll aplica fundo sólido mantendo contraste.
2. `RecipeHero`: imagem opcional (Painter), título, subtítulo e tempo de preparo (`IconRegistry.Timer`). Sem overlay/badge/CTA de vídeo. Deve aceitar fallback ilustrado.
3. `TitleBlock`: título + subtítulo usando `CompositionLocalProvider` para estilos Large/Small. Slots `title`/`subtitle` aceitam `@Composable`.
4. `RecipeTabs`: TabRow em formato pill (3 itens por padrão) com props `items`, `selectedIndex`, `onSelect`, `scrollable`. Role=Tab, indicador animado e foco visível.
5. `IngredientRow`: recebe `rawText`, `highlighted: AnnotatedString?` e usa heurística interna para colocar `SpanStyle(fontWeight = Bold)` em quantidades quando `highlighted` for nulo. Não há checkbox/carrinho.
6. `InstructionRow`: linha numerada simples (`index`, `text: AnnotatedString`) com tipografia padrão e espaçamento conforme layout. Sem chips ou tooltips.
7. `NutritionPlaceholder`: componente semântico para ausência de dados, usando ícone do `IconRegistry` (ex.: `IconRegistry.Nutrition`) e mensagem configurável.
8. APIs estateless, recebendo `Modifier` e dados externos. Nenhum componente acessa `ViewModel` diretamente ou exige objetos específicos do app.
9. Acessibilidade: todos os alvos ≥48dp, tabs com role correta, `contentDescription` configurável para imagens, suporte a `fontScale≈2.0`.
10. Previews: light/dark + fontScale para cada componente (AppBar, Hero, Tabs, IngredientRow, InstructionRow, NutritionPlaceholder).
11. Testes Compose: smoke + interação (p.ex., selecionar tabs, verificar destaque automático de quantidades) cobrindo todos os componentes em escopo.

### UI Parity vs Mock (design/recipe-detail/img.png)
- Referência visual limitada às seções em escopo: App Bar com Voltar/Editar, hero com imagem + texto, tabs pill, lista de ingredientes e lista de instruções simples, além do placeholder de nutrição.
- Ignorar elementos fora do Épico 01 (Resumo Nutritivo, CTA “Iniciar Preparo”, Stepper, botão “Medidas”, overlay/badge de vídeo, chips/tooltips e ações de carrinho/favorito).
- Respeitar tokens de espaçamento e tipografia mesmo quando áreas fora de escopo estiverem ausentes, garantindo continuidade visual.

## Dependencies
- Layout de referência: `design/recipe-detail/img.png` (usar apenas áreas dentro do Épico 01).
- Story 1.6 (consumidora): `docs/stories/1.6.redesenhar-detalhe-da-receita.md`.
- PRD Detalhe: `docs/prd.md:72,111-130` (tabs e estados; ignorar seções sobre CTA/Stepper/Resumo).
- Arquitetura/Standards: `docs/architecture.md`, `docs/architecture/coding-standards.md`.

## Tasks / Subtasks
- [ ] DS — RecipeAppBarActions (clusters leading/trailing em escopo)
- [ ] DS — RecipeHero (imagem opcional, tempo, sem overlay de vídeo)
- [ ] DS — TitleBlock (styles Large/Small)
- [ ] DS — RecipeTabs (pills acessíveis)
- [ ] DS — IngredientRow (destaque automático de quantidades)
- [ ] DS — InstructionRow (lista numerada simples)
- [ ] DS — NutritionPlaceholder (placeholder textual/visual)
- [ ] DS — Previews
- [ ] Handoff — snippets de uso para integração na Story 1.6

## Dev Notes
- Referências cruzadas:
  - Story 1.6 (Detalhe): `docs/stories/1.6.redesenhar-detalhe-da-receita.md`
  - Layout: `design/recipe-detail/img.png` (usar apenas as áreas em escopo)
  - Arquitetura/Standards: `docs/architecture.md`, `docs/architecture/coding-standards.md`
- Componentes residem no módulo `ds`, pacote `ds.recipe.detail`, seguindo tokens de `CookzyTheme`.
- Assinaturas sugeridas:
  - `data class RecipeAction(val icon: ImageVector, val contentDescription: String, val onClick: () -> Unit)`
  - `@Composable fun RecipeAppBarActions(leading: List<RecipeAction>, trailing: List<RecipeAction>, modifier: Modifier = Modifier)`
  - `@Composable fun RecipeHero(title: String, subtitle: String?, timeMinutes: Int?, image: Painter?, modifier: Modifier = Modifier)`
  - `enum class TitleBlockStyle { Large, Small }`
  - `@Composable fun TitleBlock(style: TitleBlockStyle, title: @Composable () -> Unit, subtitle: (@Composable () -> Unit)? = null, modifier: Modifier = Modifier)`
  - `data class RecipeTabItem(val label: String)`
  - `@Composable fun RecipeTabs(items: List<RecipeTabItem>, selectedIndex: Int, onSelect: (Int) -> Unit, modifier: Modifier = Modifier)`
  - `@Composable fun IngredientRow(rawText: String, highlighted: AnnotatedString? = null, modifier: Modifier = Modifier)`
  - `@Composable fun InstructionRow(index: Int, text: AnnotatedString, modifier: Modifier = Modifier)`
  - `@Composable fun NutritionPlaceholder(text: String, modifier: Modifier = Modifier)`
- Destaque de quantidade: heurística simples (regex para números/frações + unidades comuns) aplicada quando `highlighted` não for fornecido.
- Strings/Ícones: DS aceita strings prontas mas origem deve ser `strings.xml`. Ícones apenas via `IconRegistry`.
- Previews: `@Preview` night/notnight + `fontScale = 2f` para cada componente. Usar `PlaceholderHighlight.fade()` para estados loading.

### Handoff — snippets de uso (Story 1.6)
```kotlin
@Composable
fun RecipeDetailHeader(
  state: RecipeDetailState,
  onBack: () -> Unit,
  onClose: () -> Unit,
  onEdit: () -> Unit
) {
  RecipeAppBarActions(
    leading = listOf(
      RecipeAction(IconRegistry.Close, stringResource(R.string.cd_close), onClose),
      RecipeAction(IconRegistry.Back, stringResource(R.string.cd_back), onBack)
    ),
    trailing = listOf(
      RecipeAction(IconRegistry.Edit, stringResource(R.string.cd_edit), onEdit)
    )
  )
  RecipeHero(
    title = state.title,
    subtitle = state.subtitle,
    timeMinutes = state.timeMinutes,
    image = state.imagePainter
  )
  TitleBlock(
    style = TitleBlockStyle.Large,
    title = { Text(state.title) },
    subtitle = state.subtitle?.let { { Text(it) } }
  )
}

@Composable
fun RecipeDetailTabs(selected: Int, onSelect: (Int) -> Unit) {
  val items = listOf(
    RecipeTabItem(stringResource(R.string.recipe_detail_tab_ingredients)),
    RecipeTabItem(stringResource(R.string.recipe_detail_tab_instructions)),
    RecipeTabItem(stringResource(R.string.recipe_detail_tab_nutrition))
  )
  RecipeTabs(items = items, selectedIndex = selected, onSelect = onSelect)
}

@Composable
fun IngredientSection(items: List<IngredientUiModel>) {
  LazyColumn {
    items(items) { item ->
      IngredientRow(
        rawText = item.rawText,
        highlighted = item.highlighted
      )
    }
  }
}

@Composable
fun InstructionSection(steps: List<InstructionUiModel>) {
  LazyColumn {
    itemsIndexed(steps) { index, step ->
      InstructionRow(
        index = index + 1,
        text = step.annotated
      )
    }
  }
}

@Composable
fun NutritionSection(hasData: Boolean) {
  if (!hasData) {
    NutritionPlaceholder(
      text = stringResource(R.string.recipe_detail_nutrition_empty)
    )
  } else {
    Text(stringResource(R.string.recipe_detail_nutrition_basic_info))
  }
}
```

## Change Log
| Date       | Version | Description                            | Author |
|------------|---------|----------------------------------------|--------|
| 2025-11-03 | 0.3     | Escopo realinhado ao Épico 01 (somente componentes básicos) | PO     |
| 2025-11-03 | 0.2     | Alinhado ao layout (AppBar, cards, CTA, stepper, chips, tooltip) | PO     |
| 2025-11-03 | 0.1     | Rascunho inicial (DS RecipeDetail)     | PO     |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
Gate: TBD (escopo realinhado; aguardar revisão focada nos componentes básicos)
Reviewer: Quinn (Test Architect)
Updated: 2025-11-03
Summary: Com a remoção de Stepper/CTA/tooltips, os componentes se restringem a App Bar, Hero, Tabs e listas. QA deve verificar apenas esses blocos e garantir cobertura de destaque automático de ingredientes.
Top Issues:
- medium — Falta teste garantindo heurística de quantidade em `IngredientRow`.
- medium — Necessário validar role/tab navegação do `RecipeTabs` em TalkBack.
Evidence: Epic `docs/epics/01-crud-de-receitas.md`, Story 1.6 atualizada, protótipo `design/recipe-detail/img.png`.
Gate File: docs/qa/gates/1.9-ds-componentes-recipe-detail.yml (gerar após review)
