# Story 1.7: Design System — Componentes para RecipeList (Épico 01)

## Status
Approved

## Story
**Como** equipe de desenvolvimento do Cookzy,
**eu quero** criar/modernizar componentes reutilizáveis (DS) para a Home/Lista de Receitas,
**para** acelerar a implementação consistente da Story 1.4 com acessibilidade, testes e manutenção facilitada.

## Acceptance Criteria
1. Componentes DS criados no módulo `ds` e prontos para uso na 1.4:
   - AppTopBar com busca inline (campo substitui o título; ícones: `Back` sai do modo busca, `Clear` limpa o texto; IME=Search dispara `onSubmit`; quando a busca estiver ativa usar `scrollBehavior` do tipo pinned; debounce de 400 ms ficará na integração/tela/ViewModel).
   - RecipeCard (normal/loading/error) com título, imagem, tempo e livros.
   - RecentCarousel usando `HorizontalPager` (1 card/viewport, snap, PEEK via `contentPadding`).
   - LayoutToggle (list ↔ grid) stateless.
   - EmptyState e ErrorState (variante Home) com CTA.
2. APIs stateless (estado elevado) e estáveis: parâmetros claros, nomes consistentes, sem dependência de ViewModel.
3. Acessibilidade: roles/labels/foco definidos conforme docs; alvos 48dp quando aplicável.
4. Previews: light/dark e pelo menos uma variação com `fontScale` ~2.0 para cada componente.
5. Testes Compose: smoke tests de renderização/estados e interação essencial (toggle, clique em CTA, etc.).
6. Iconografia: todos os ícones consumidos via `IconRegistry` exclusivamente.
7. Fora de escopo: carrossel de “Livros (filtro)”.

## Tasks / Subtasks
- [ ] DS — AppTopBar com busca inline (API, estados, clear; previews; a11y; testes)
  - [ ] Estados: inativo (título) ↔ ativo (campo substitui título) com transição leve (Crossfade/AnimatedContent)
  - [ ] Ações: `Back` desativa busca; `Clear` limpa texto; IME=Search chama `onSubmit`
  - [ ] Scroll: quando `search.active == true`, usar comportamento pinned; caso contrário, a tela pode adotar `enterAlways`/`exitUntilCollapsed`
- [ ] DS — RecipeCard v2 (normal/loading/error; previews; testes)
- [ ] DS — RecentCarousel (HorizontalPager: pageSize=Fill, PEEK, snap; previews; testes)
- [ ] DS — LayoutToggle (list/grid; a11y; previews; testes)
- [ ] DS — EmptyState e ErrorState (variante Home; CTA; previews; testes)
- [ ] DS — Verificação de iconografia (consumo exclusivo via `IconRegistry`)
- [ ] Handoff — exemplo de uso em `RecipeListScreen` (snippet em Dev Notes)

## Dev Notes
- Ver “Component Library / Design System” em `docs/front-end-spec.md` (itens 1, 2, 3, 10, 12, 13) e “Home” (Key Elements).
- Reuso de tema: `ds.theme.AppTheme`, `Color.kt`, `Type.kt` e Material 3.
- App Bar: expor `onSearchChange`, `onClear`, `onBack`/`onAction` conforme necessário; o debounce de 400 ms será responsabilidade da tela/ViewModel (Story 1.4).
- App Bar — busca inline: quando ativa, o campo substitui o título na mesma barra; recomenda-se `scrollBehavior` pinned enquanto a busca estiver ativa para evitar que o campo desapareça durante a digitação.
- Carrossel “Recentes”: usar `androidx.compose.foundation.pager.HorizontalPager` (Compose Foundation) com `pageSize = PageSize.Fill`, `contentPadding` para PEEK e snapping por cartão.
- Cards e estados: skeleton simples via shapes/cores do tema.
- A11y: `contentDescription`, `role`/`stateDescription` quando aplicável; ordem de foco previsível.

#### Handoff — snippet de uso (`RecipeListScreen`)
```kotlin
@Composable
fun RecipeListScreen(...) {
  var searchActive by remember { mutableStateOf(false) }
  var query by remember { mutableStateOf("") }

  val scrollBehavior = if (searchActive) {
    TopAppBarDefaults.pinnedScrollBehavior()
  } else {
    TopAppBarDefaults.enterAlwaysScrollBehavior()
  }

  val searchUi = AppTopBarSearchUi(
    active = searchActive,
    query = query,
    onActivate = { searchActive = true },
    onDeactivate = { searchActive = false },
    onQueryChange = { query = it },
    onSubmit = { /* viewModel.onSearch(query) with debounce in VM */ },
    onClear = { query = "" },
    placeholder = stringResource(R.string.search_placeholder)
  )

  Scaffold(
    modifier = Modifier.nestedScroll(scrollBehavior.nestedScrollConnection),
    topBar = {
      AppTopBar(
        title = stringResource(R.string.app_name),
        search = searchUi,
        navigationIcon = { /* IconRegistry.Back when active */ },
        actions = { /* favorites/profile actions */ },
        scrollBehavior = scrollBehavior,
      )
    }
  ) { padding ->
    LazyColumn(contentPadding = padding) {
      // items(...)
    }
  }
}
```

### Testing
- Compose UI: renderização de cada estado, cliques básicos e alternância list/grid.
- A11y: existência de `contentDescription`/roles nos principais elementos.
- Negativo: componentes não devem depender de ViewModel/DI; ícones via `IconRegistry` apenas.

## Change Log
| Date       | Version | Description                                | Author |
|------------|---------|--------------------------------------------|--------|
| 2025-10-28 | 0.1     | Criação da história técnica de componentes | Dev    |
| 2025-10-28 | 0.2     | Aprovação do draft após validação (PO)     | PO     |
| 2025-10-28 | 0.3     | Refinamento UX AppTopBar (busca inline substitui título; pinned quando ativa; Back/Clear/IME) | PO     |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
