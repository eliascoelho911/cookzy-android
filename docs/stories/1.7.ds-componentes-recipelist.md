# Story 1.7: Design System — Componentes para RecipeList (Épico 01)

## Status
Approved

## Story
**Como** equipe de desenvolvimento do Cookzy,
**eu quero** criar/modernizar componentes reutilizáveis (DS) para a Home/Lista de Receitas,
**para** acelerar a implementação consistente da Story 1.4 com acessibilidade, testes e manutenção facilitada.

## Acceptance Criteria
1. Componentes DS criados no módulo `ds` e prontos para uso na 1.4:
   - AppTopBar com busca inline (campo substitui o título; ícones: `Back` sai do modo busca, `Clear` limpa o texto; IME=Search dispara `onSubmit`; quando a busca estiver ativa usar `scrollBehavior` do tipo pinned; debounce de 400 ms ficará na integração/tela/ViewModel).
   - RecipeCard com duas variações e estados (normal/loading/error):
     - Variações: `List` e `Tile` (renomeado de "Grid").
     - Conteúdo exibido: cover (quando disponível), título, tempo de preparo (opcional) e livros de receitas.
       - Tempo: exibir quando informado, com ícone `Timer`.
       - Livros: exibir contagem compacta (ex.: "2 livros"/"1 livro").
   - RecentCarousel usando `HorizontalPager` (1 card/viewport, snap, PEEK via `contentPadding`) e utilizando `RecipeCard` na variação `Tile`.
   - IconToggle (genérico, 2 estados) — usado para alternar layout "List" ↔ "Tile"; stateless.
   - EmptyState e ErrorState (genéricos, com estados genéricos) com CTA; devem permitir customizar ilustração e textos padrão.
2. APIs stateless (estado elevado) e estáveis: parâmetros claros, nomes consistentes, sem dependência de ViewModel.
3. Acessibilidade: roles/labels/foco definidos conforme docs; alvos 48dp quando aplicável.
4. Previews: light/dark e pelo menos uma variação com `fontScale` ~2.0 para cada componente.
5. Testes Compose: smoke tests de renderização/estados e interação essencial (toggle, clique em CTA, etc.).
6. Iconografia: todos os ícones consumidos via `IconRegistry` exclusivamente.
7. Fora de escopo: carrossel de “Livros (filtro)”.

## Tasks / Subtasks
- [ ] DS — AppTopBar com busca inline (API, estados, clear; previews; a11y; testes)
  - [ ] Estados: inativo (título) ↔ ativo (campo substitui título) com transição leve (Crossfade/AnimatedContent)
  - [ ] Ações: `Back` desativa busca; `Clear` limpa texto; IME=Search chama `onSubmit`
  - [ ] Scroll: quando `search.active == true`, usar comportamento pinned; caso contrário, a tela pode adotar `enterAlways`/`exitUntilCollapsed`
- [ ] DS — RecipeCard v2 (variações List/Tile; estados normal/loading/error; previews; testes)
  - [ ] `List`: item horizontal com thumbnail, título (até 2 linhas) e linha de metadados (tempo + livros)
  - [ ] `Tile`: card vertical para grade/carrossel; imagem em destaque; título abaixo; metadados compactos
  - [ ] A11y: `contentDescription` para imagem; ordem de foco previsível; alvo ≥48dp
  - [ ] Exibir tempo somente quando disponível; livros como contagem textual
- [ ] DS — RecentCarousel (HorizontalPager: pageSize=Fill, PEEK, snap; previews; testes)
  - [ ] Usar `RecipeCard` na variação `Tile`
- [ ] DS — IconToggle (genérico; 2 estados; a11y; previews; testes)
  - [ ] Opções com ícones vindos de `IconRegistry` (ex.: `ViewList`, `ViewTiles`)
  - [ ] Stateless: `selectedIndex` + `onSelect(index)`
  - [ ] A11y: `role = Role.Tab` ou `toggleable`; `stateDescription` da opção ativa; `contentDescription` por opção
  - [ ] Hit target ≥ 48dp; seleção com alto contraste; foco visível
  - [ ] Previews: light/dark; `fontScale≈2.0`; estados esquerdo/direito selecionados
- [ ] DS — EmptyState e ErrorState (genéricos; CTA; previews; testes)
  - [ ] Stateless e reutilizáveis em múltiplos contextos (Home, Buscar, Livros, etc.)
  - [ ] Permitir customização de ilustração (slot `@Composable () -> Unit`), título, mensagem e CTAs
  - [ ] Disponibilizar `Defaults` com cópias sugeridas e ícones/ilustrações padrão, passíveis de override
  - [ ] A11y: título como heading; imagem decorativa sem leitura quando apropriado; ordem de foco previsível; CTAs com descrição
  - [ ] Previews: variações com/sem ilustração; com 1 e 2 CTAs; light/dark; `fontScale≈2.0`
- [ ] DS — Verificação de iconografia (consumo exclusivo via `IconRegistry`)
- [ ] Handoff — exemplo de uso em `RecipeListScreen` (snippet em Dev Notes)

## Dev Notes
- Ver “Component Library / Design System” em `docs/front-end-spec.md` (itens 1, 2, 3, 10, 12, 13) e “Home” (Key Elements).
- Reuso de tema: `ds.theme.AppTheme`, `Color.kt`, `Type.kt` e Material 3.
- App Bar: expor `onSearchChange`, `onClear`, `onBack`/`onAction` conforme necessário; o debounce de 400 ms será responsabilidade da tela/ViewModel (Story 1.4).
- App Bar — busca inline: quando ativa, o campo substitui o título na mesma barra; recomenda-se `scrollBehavior` pinned enquanto a busca estiver ativa para evitar que o campo desapareça durante a digitação.
- Carrossel “Recentes”: usar `androidx.compose.foundation.pager.HorizontalPager` (Compose Foundation) com `pageSize = PageSize.Fill`, `contentPadding` para PEEK e snapping por cartão.
- Cards e estados: skeleton simples via shapes/cores do tema.
- A11y: `contentDescription`, `role`/`stateDescription` quando aplicável; ordem de foco previsível.

##### Assinaturas sugeridas (DS)
```kotlin
// IconToggle (genérico, 2 estados)
data class IconToggleOption(
  val icon: ImageVector,
  val contentDescription: String,
  val label: String? = null,
)

@Composable
fun IconToggle(
  options: List<IconToggleOption>, // size == 2
  selectedIndex: Int,
  onSelect: (Int) -> Unit,
  modifier: Modifier = Modifier,
) // Stateless; role=TabRow ou toggleable; hit ≥ 48dp

// RecipeCard
enum class RecipeCardVariant { List, Tile }

data class RecipeCardMeta(
  val time: Duration?, // exibir somente quando != null
  val booksCount: Int?, // exibir como "N livros" quando > 0
)

@Composable
fun RecipeCard(
  title: String,
  imageUrl: String?,
  meta: RecipeCardMeta,
  variant: RecipeCardVariant,
  onClick: () -> Unit,
  modifier: Modifier = Modifier,
)

// RecentCarousel
@Composable
fun RecentCarousel(
  items: List<RecipeUi>,
  onClick: (RecipeUi) -> Unit,
  peek: Dp,
  modifier: Modifier = Modifier,
) // Usa RecipeCard(variant = Tile)

// EmptyState
data class ButtonSpec(
  val text: String,
  val onClick: () -> Unit,
)

object EmptyStateDefaults {
  @Composable fun Illustration() { /* ícone/ilustração padrão via tema */ }
  fun copy(title: String, message: String) = EmptyStateCopy(title, message)
}

data class EmptyStateCopy(val title: String, val message: String)

@Composable
fun EmptyState(
  illustration: (@Composable () -> Unit)? = null,
  copy: EmptyStateCopy,
  primaryAction: ButtonSpec? = null,
  secondaryAction: ButtonSpec? = null,
  modifier: Modifier = Modifier,
)

// ErrorState
object ErrorStateDefaults {
  @Composable fun Illustration() { /* ícone/ilustração padrão */ }
  fun copy(title: String, message: String) = ErrorStateCopy(title, message)
}

data class ErrorStateCopy(val title: String, val message: String)

@Composable
fun ErrorState(
  illustration: (@Composable () -> Unit)? = null,
  copy: ErrorStateCopy,
  primaryAction: ButtonSpec? = null,
  secondaryAction: ButtonSpec? = null,
  modifier: Modifier = Modifier,
)
```

##### Iconografia
- Adicionar ao `IconRegistry`: `ViewList`, `ViewTiles` (ex.: `ViewModule`/`Apps`) para o `IconToggle` de layout.

#### Detalhamento dos Componentes (exibição)

- RecipeCard.List (horizontal)
  - Imagem: thumbnail quadrado; `contentDescription` com título da receita.
  - Título: até 2 linhas; ellipsis ao exceder.
  - Metadados: `IconRegistry.Timer` + tempo (quando houver); contagem de livros (ex.: "2 livros").
  - Toque: toda a linha é clicável; ripple padrão.

- RecipeCard.Tile (vertical)
  - Imagem: destaque no topo; `contentDescription` com título.
  - Título: abaixo da imagem; até 2 linhas.
  - Metadados: linha compacta abaixo do título (tempo + livros).
  - Uso: grade e carrossel de Recentes.

- RecentCarousel
  - Item: `RecipeCard.Tile` ocupando o viewport (PageSize.Fill) com PEEK do próximo via `contentPadding`.
  - A11y: anunciar "deslize para ver mais"; foco previsível.

- IconToggle (genérico)
  - Estrutura: controle segmentado com duas opções (ícone + label opcional).
  - Entrada: `options: List<IconToggleOption>` (tamanho 2), `selectedIndex: Int`, `onSelect(Int)`.
  - Visual: opção ativa com fundo destacado; ícone neutro nas inativas; cantos médios.
  - A11y: tratada como tabs (preferível) ou toggle; leitura do estado atual.
  - Uso: alternar List ↔ Tile; reutilizável para outros binários (p.ex., sort asc/desc).

#### Handoff — snippet de uso (`RecipeListScreen`)
```kotlin
@Composable
fun RecipeListScreen(...) {
  var searchActive by remember { mutableStateOf(false) }
  var query by remember { mutableStateOf("") }

  val scrollBehavior = if (searchActive) {
    TopAppBarDefaults.pinnedScrollBehavior()
  } else {
    TopAppBarDefaults.enterAlwaysScrollBehavior()
  }

  val searchUi = AppTopBarSearchUi(
    active = searchActive,
    query = query,
    onActivate = { searchActive = true },
    onDeactivate = { searchActive = false },
    onQueryChange = { query = it },
    onSubmit = { /* viewModel.onSearch(query) with debounce in VM */ },
    onClear = { query = "" },
    placeholder = stringResource(R.string.search_placeholder)
  )

  Scaffold(
    modifier = Modifier.nestedScroll(scrollBehavior.nestedScrollConnection),
    topBar = {
      AppTopBar(
        title = stringResource(R.string.app_name),
        search = searchUi,
        navigationIcon = { /* IconRegistry.Back when active */ },
        actions = { /* favorites/profile actions */ },
        scrollBehavior = scrollBehavior,
      )
    }
  ) { padding ->
    LazyColumn(contentPadding = padding) {
      // items(...)
    }
  }
}
```

### Testing
- Compose UI: renderização de cada estado, cliques básicos e alternância list/grid.
- A11y: existência de `contentDescription`/roles nos principais elementos.
- Negativo: componentes não devem depender de ViewModel/DI; ícones via `IconRegistry` apenas.

## Change Log
| Date       | Version | Description                                | Author |
|------------|---------|--------------------------------------------|--------|
| 2025-10-28 | 0.1     | Criação da história técnica de componentes | Dev    |
| 2025-10-28 | 0.2     | Aprovação do draft após validação (PO)     | PO     |
| 2025-10-28 | 0.4     | Detalhamento de RecipeCard (List/Tile) e RecentCarousel usando Tile | PO     |
| 2025-10-28 | 0.3     | Refinamento UX AppTopBar (busca inline substitui título; pinned quando ativa; Back/Clear/IME) | PO     |
| 2025-10-28 | 0.5     | LayoutToggle → IconToggle genérico; assinaturas DS e iconografia | PO     |

## Dev Agent Record

### Agent Model Used

- Codex (GPT-5)

### Debug Log References

- n/a

### Completion Notes List

- Added AppTopBar inline search, RecipeCard variants, RecentCarousel, IconToggle, and Empty/Error state components with accessibility, previews, and IconRegistry updates.
- Introduced supporting strings/resources and Compose UI tests verifying search actions, recipe card retry, icon toggle switching, informational state CTAs, and carousel swiping.
- Updated DS build configuration for Compose testing support.

### File List

- ds/build.gradle.kts
- ds/src/main/java/com/eliascoelho911/cookzy/ds/components/AppTopBar.kt
- ds/src/main/java/com/eliascoelho911/cookzy/ds/components/RecipeCard.kt
- ds/src/main/java/com/eliascoelho911/cookzy/ds/components/RecentCarousel.kt
- ds/src/main/java/com/eliascoelho911/cookzy/ds/components/IconToggle.kt
- ds/src/main/java/com/eliascoelho911/cookzy/ds/components/InformationalStates.kt
- ds/src/main/res/values/strings.xml
- ds/src/androidTest/java/com/eliascoelho911/cookzy/ds/components/AppTopBarTest.kt
- ds/src/androidTest/java/com/eliascoelho911/cookzy/ds/components/RecipeCardTest.kt
- ds/src/androidTest/java/com/eliascoelho911/cookzy/ds/components/IconToggleTest.kt
- ds/src/androidTest/java/com/eliascoelho911/cookzy/ds/components/InformationalStatesTest.kt
- ds/src/androidTest/java/com/eliascoelho911/cookzy/ds/components/RecentCarouselTest.kt

## QA Results
